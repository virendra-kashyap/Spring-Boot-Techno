<!DOCTYPE html>
<html>
<head>
<title>WebSocket Example</title>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/sockjs/1.4.0/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
	<form id="messageForm">
		<input type="text" id="name" placeholder="Enter your name">
		<button type="submit">Send</button>
	</form>
	<div id="greetings"></div>

	<script>
		var stompClient = null;

		function connect() {
			var socket = new SockJS('/websocket-example');
			stompClient = Stomp.over(socket);
			stompClient.connect({}, function(frame) {
				console.log('Connected: ' + frame);
				stompClient.subscribe('/topic/greetings', function(greeting) {
					showGreeting(JSON.parse(greeting.body).content);
				});
			});
		}

		function disconnect() {
			if (stompClient !== null) {
				stompClient.disconnect();
			}
			console.log("Disconnected");
		}

		function sendMessage() {
			var name = $("#name").val();
			stompClient.send("/app/hello", {}, JSON.stringify({
				'name' : name
			}));
		}

		function showGreeting(message) {
			$("#greetings").append("<p>" + message + "</p>");
		}

		$(function() {
			$("form").on('submit', function(e) {
				e.preventDefault();
			});
			connect();
			$("#messageForm").submit(function() {
				sendMessage();
				return false;
			});
		});
	</script>
</body>
</html>